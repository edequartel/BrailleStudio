<!-- /pages/activity-runner.html -->
<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BrailleStudio - BartimÃ©us Onderwijs</title>

  <meta name="color-scheme" content="light dark" />

  <link rel="stylesheet" href="../components/braille-monitor/braillemonitor.css" />
  <link rel="stylesheet" href="./activity-runner.css" />
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />

  <style>
    /* Minimal floating settings button */
    .settings-fab{
      position: fixed;
      right: 14px;
      bottom: 14px;
      z-index: 9999;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 52px;
      height: 52px;
      border-radius: 999px;
      border: 1px solid rgba(127,127,127,.35);
      background: rgba(255,255,255,.10);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      color: inherit;
      text-decoration: none;
      box-shadow: 0 10px 22px rgba(0,0,0,.22);
      cursor: pointer;
      user-select: none;
    }
    html[data-theme="dark"] .settings-fab{
      background: rgba(20,24,36,.55);
      border-color: rgba(255,255,255,.16);
    }
    .settings-fab:hover{ transform: translateY(-1px); }
    .settings-fab:active{ transform: translateY(0); }
    .settings-fab svg{ width: 24px; height: 24px; display: block; }
    .settings-fab:focus-visible{
      outline: 3px solid rgba(122,162,255,.55);
      outline-offset: 3px;
    }

    /* Markdown instruction panel */
    #activity-instruction { white-space: normal; }
    #activity-instruction h1,
    #activity-instruction h2,
    #activity-instruction h3 {
      margin: 0 0 .5rem 0;
      line-height: 1.2;
    }
    #activity-instruction p { margin: 0 0 .6rem 0; }
    #activity-instruction p:last-child { margin-bottom: 0; }
    #activity-instruction ul,
    #activity-instruction ol { margin: 0 0 .6rem 1.2rem; padding: 0; }
    #activity-instruction code {
      padding: .1rem .25rem;
      border-radius: 6px;
      background: rgba(127,127,127,.12);
    }
    html[data-theme="dark"] #activity-instruction code { background: rgba(255,255,255,.10); }
    #activity-instruction a { text-decoration: underline; }

    /* Nav: only Prev + Auto + Next (no Start button) */
    .braille-nav{
      display:grid;
      align-items:center;
      grid-template-columns: 1fr auto 1fr;
      gap:.75rem;
      margin-top: .75rem;
    }
    .braille-nav > button{
      width: 100%;
    }
    .runner-controls{
      display:flex;
      align-items:center;
      gap: 10px;
      flex: 0 0 auto;
      justify-self: center;
    }
    .auto-next{
      display:flex;
      align-items:center;
      gap: 8px;
      font-size: .9rem;
      user-select: none;
    }
    .auto-next input { transform: scale(1.05); }
  </style>
</head>

<body>
  <main class="container" aria-live="polite">
    <div class="braille-panel">
      <div class="word-header">
        <span id="field-emoji" class="word-emoji" aria-hidden="true">â€“</span>

        <div class="word-line">
          <span id="field-word" class="word-text">â€“</span>
          <span id="field-word-braille" class="word-braille">â€“</span>
        </div>
      </div>

      <div class="braille-nav" aria-label="Navigatie">
        <button id="prev-btn" class="secondary" type="button" aria-label="Vorige">
          â—€
        </button>

        <span class="runner-controls">
          <label class="auto-next" title="Automatisch volgende activiteit starten">
            <input id="auto-run" type="checkbox" checked />
            <span></span>
          </label>
        </span>

        <button id="next-btn" class="secondary" type="button" aria-label="Volgende">
          â–¶
        </button>
      </div>
    </div>

    <div id="brailleMonitorComponent"></div>

    <p class="field-value" id="activity-instruction">â€“</p>

    <div class="top-controls">
      <div class="top-controls__left">
        <div id="activity-buttons" class="buttons buttons-left" aria-label="Activiteiten"></div>
      </div>

      <div class="top-controls__right">
        <div class="buttons buttons-right">
          <button
            id="home-btn"
            class="secondary icon-button home-button"
            type="button"
            aria-label="Home"
            onclick="window.location.href = '../index.html'">
            ğŸ 
          </button>

          <button
            id="toggle-fields-btn"
            class="secondary icon-button"
            type="button"
            aria-controls="fields-panel"
            aria-expanded="false">
            â“˜
          </button>

          <button id="toggle-log-btn" class="secondary icon-button" type="button" aria-label="Log">
            ğŸ“œ
          </button>

          <button
            id="themeToggle"
            class="theme-toggle icon-button"
            type="button"
            aria-label="Toggle theme">
            ğŸŒ“
          </button>
        </div>
      </div>
    </div>

    <section id="fields-panel" class="log-panel hidden" aria-label="Info">
      <div class="log-header">
        <span>Info</span>
      </div>
      <div id="field-all" class="log-body">â€“</div>
    </section>

    <section id="log-panel" class="log-panel hidden" aria-label="Log">
      <div class="log-header">
        <span>Log</span>
        <span class="log-controls">
          <button id="clear-log-btn" type="button">Clear</button>
        </span>
      </div>
      <div id="log" class="log-body">Log startâ€¦</div>
    </section>

    <div class="bottom-actions">
      <a class="secondary icon-button" href="braillebridge://"
        aria-label="Start BrailleBridge">ğŸ”Œ</a>
    </div>

    <p class="version-stamp">Version: 2026.01.05.1434 â€” 2026-01-05 14:34</p>
  </main>

  <a class="settings-fab" href="../pages/settings.html" aria-label="Settings">
    <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
      <path fill="currentColor"
        d="M19.14,12.94c.04-.31.06-.63.06-.94s-.02-.63-.06-.94l2.03-1.58
        c.18-.14.23-.4.12-.61l-1.92-3.32c-.11-.2-.35-.28-.56-.2l-2.39.96
        c-.5-.38-1.04-.69-1.64-.92l-.36-2.54C14.4,2.18,14.2,2,13.96,2h-3.92
        C9.8,2,9.6,2.18,9.56,2.42L9.2,4.96c-.6.23-1.14.54-1.64.92l-2.39-.96
        c-.21-.08-.45,0-.56.2L2.69,8.44c-.11.21-.06.47.12.61l2.03,1.58
        c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03,1.58c-.18.14-.23.4-.12.61
        l1.92,3.32c.11.2.35.28.56.2l2.39-.96c.5.38,1.04.69,1.64.92l.36,2.54
        c.04.24.24.42.48.42h3.92c.24,0,.44-.18.48-.42l.36-2.54
        c.6-.23,1.14-.54,1.64-.92l2.39.96c.21.08.45,0,.56-.2l1.92-3.32
        c.11-.21.06-.47-.12-.61L19.14,12.94z M12,15.5c-1.93,0-3.5-1.57-3.5-3.5
        s1.57-3.5,3.5-3.5s3.5,1.57,3.5,3.5S13.93,15.5,12,15.5z" />
    </svg>
  </a>

  <script>
    (function () {
      const THEME_KEY = "bs_theme";
      const html = document.documentElement;

      function applyTheme(theme) {
        html.setAttribute("data-theme", theme);
        const label = document.getElementById("themeLabel");
        if (label) label.textContent = "";
      }

      function getInitialTheme() {
        const saved = localStorage.getItem(THEME_KEY);
        if (saved === "light" || saved === "dark") return saved;
        return window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches
          ? "dark"
          : "light";
      }

      function appendToPanel(line) {
        const el = document.getElementById("log");
        if (!el) return;
        if (el.textContent === "Log startâ€¦") el.textContent = "";
        el.textContent += line + "\n";
        el.scrollTop = el.scrollHeight;
      }

      if (typeof window.logMessage !== "function") {
        window.logMessage = function (msg) {
          appendToPanel(String(msg));
          console.log(msg);
        };
      }

      document.addEventListener("DOMContentLoaded", () => {
        applyTheme(getInitialTheme());

        const tbtn = document.getElementById("themeToggle");
        if (tbtn) {
          tbtn.addEventListener("click", () => {
            const current =
              html.getAttribute("data-theme") === "dark" ? "dark" : "light";
            const next = current === "dark" ? "light" : "dark";
            localStorage.setItem(THEME_KEY, next);
            applyTheme(next);
            window.logMessage("[theme] " + next);
          });
        }

        const btn = document.getElementById("clear-log-btn");
        if (btn) {
          btn.addEventListener("click", () => {
            const el = document.getElementById("log");
            if (el) el.textContent = "";
          });
        }

        const toggle = document.getElementById("toggle-log-btn");
        const panel = document.getElementById("log-panel");
        if (toggle && panel) {
          toggle.addEventListener("click", () => {
            panel.classList.toggle("hidden");
          });
        }

        window.logMessage("[words.html] Inline logger ready.");
      });
    })();
  </script>

  <script src="../js/logging.js"></script>
  <script src="../js/braillebridge.js"></script>
  <script src="../components/braille-monitor/braillemonitor.js"></script>

  <!-- audio -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
  <script src="../js/sounds.js"></script>
  <script src="../js/feedback.js"></script>

  <!-- Marked -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- activities -->
  <script src="../activities/tts.js"></script>
  <script src="../activities/letters.js"></script>
  <script src="../activities/readlines.js"></script>
  <!-- <script src="../activities/words.js"></script> -->
  <script src="../activities/story.js"></script>
  <script src="../activities/sounds.js"></script>
  <script src="../activities/pairletters.js"></script>

  <!-- Main page logic -->
  <script src="../js/runner.js"></script>
</body>
</html>
