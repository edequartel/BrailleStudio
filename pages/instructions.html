<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Audio Instructions â€“ Next/Prev</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Howler.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      padding: 1rem;
    }
    h1 { font-size: 1.2rem; margin: 0 0 1rem; }

    .box {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: .75rem;
      margin-bottom: 1rem;
    }

    .row {
      display: flex;
      gap: .5rem;
      flex-wrap: wrap;
      align-items: center;
    }

    button {
      font-size: 1rem;
      padding: .6rem 1rem;
      min-width: 9rem;
    }

    .title { font-weight: 800; margin-top: .25rem; }
    .meta { font-size: .9rem; color: #444; margin-top: .25rem; }
  </style>
</head>
<body>

<h1>Audio-only instructies</h1>

<div class="box">
  <div class="row">
    <button id="prevBtn">Vorige</button>
    <button id="playBtn">Speel audio</button>
    <button id="nextBtn">Volgende</button>
  </div>

  <div class="title" id="instrTitle">--</div>
  <div class="meta" id="instrIndex">--</div>
</div>

<div class="box">
  <div class="title">Instructietekst</div>
  <div id="instructionText">--</div>
</div>

<!-- Engine -->
<script src="/js/instructionPlayer.js"></script>

<script>
  async function loadConfig() {
    const res = await fetch("/config/instructions.json");
    if (!res.ok) throw new Error("Kan /config/instructions.json niet laden");
    return res.json();
  }

  (async () => {
    const config = await loadConfig();
    const player = new InstructionPlayer(config); // no log

    const list = config.instructions || [];
    if (list.length === 0) {
      document.getElementById("instrTitle").textContent = "Geen instructies gevonden";
      return;
    }

    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const playBtn = document.getElementById("playBtn");

    const titleEl = document.getElementById("instrTitle");
    const idxEl = document.getElementById("instrIndex");
    const textEl = document.getElementById("instructionText");

    let currentIndex = 0;

    function render() {
      const instr = list[currentIndex];
      titleEl.textContent = instr.title || instr.id;
      idxEl.textContent = `Instructie ${currentIndex + 1} van ${list.length}`;
      textEl.textContent = instr.instructionText || "";

      prevBtn.disabled = currentIndex === 0;
      nextBtn.disabled = currentIndex === list.length - 1;
    }

    async function playCurrent() {
      const instr = list[currentIndex];

      // Audio-only: no display context needed.
      // If your scripts use `display` in expressions, you can still pass it via context later.
      await player.runInstructionById(instr.id, {});
    }

    prevBtn.addEventListener("click", () => {
      if (currentIndex > 0) {
        currentIndex--;
        render();
      }
    });

    nextBtn.addEventListener("click", () => {
      if (currentIndex < list.length - 1) {
        currentIndex++;
        render();
      }
    });

    playBtn.addEventListener("click", playCurrent);

    // Optional keyboard (desktop)
    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowLeft") prevBtn.click();
      if (e.key === "ArrowRight") nextBtn.click();
      if (e.key === "Enter") playBtn.click();
    });

    render();
  })();
</script>

</body>
</html>