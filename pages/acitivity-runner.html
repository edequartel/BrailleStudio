<!-- /pages/words.html -->
<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BrailleStudio - Bartiméus Onderwijs</title>

  <link rel="stylesheet" href="../components/braille-monitor/braillemonitor.css" />
  <link rel="stylesheet" href="./words.css" />
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
</head>

<body>
  <main class="container" aria-live="polite">
    <div class="braille-panel">
      <div class="word-header">
        <span id="field-emoji" class="word-emoji" aria-hidden="true">–</span>

        <div class="word-line">
          <span id="field-word" class="word-text">–</span>
          <span id="field-word-braille" class="word-braille">–</span>
        </div>
      </div>

      <div id="brailleMonitorComponent"></div>
    </div>

    <!-- IMPORTANT: only one element with this id -->
    <p class="field-value" id="activity-instruction">–</p>

    <div class="meta-bar">
      <span id="item-id">ID: –</span>
      <span id="item-index">0 / 0</span>
      <span id="data-status">Data: –</span>
    </div>

    <div class="meta-bar meta-bar-tight">
      <span id="activity-index">0 / 0</span>
      <span id="activity-id">Activity: –</span>
    </div>

    <div class="meta-bar meta-bar-tight">
      <span id="activity-status">Status: idle</span>

      <span class="runner-controls">
        <label class="auto-next">
          <input id="auto-run" type="checkbox" checked />
          Auto next
        </label>

        <!-- SINGLE TOGGLE BUTTON (Start/Stop) -->
        <button
          id="run-activity-btn"
          class="secondary"
          type="button"
          aria-pressed="false"
          aria-label="Start of stop de activiteit">
          Start
        </button>
      </span>
    </div>

    <!-- TOP CONTROLS BAR: left (activities), center (prev/next), right (tools) -->
    <div class="top-controls">
      <div class="top-controls__left">
        <div id="activity-buttons" class="buttons buttons-left"></div>
      </div>

      <div class="top-controls__center">
        <div class="buttons buttons-center">
          <button id="prev-btn" class="secondary" type="button">prev</button>
          <button id="next-btn" type="button">next</button>
        </div>
      </div>

      <div class="top-controls__right">
        <div class="buttons buttons-right">
          <button
            id="toggle-fields-btn"
            class="secondary"
            type="button"
            aria-controls="fields-panel"
            aria-expanded="false">
            Velden
          </button>

          <button id="toggle-log-btn" class="secondary" type="button">Log</button>

          <button
            id="themeToggle"
            class="theme-toggle"
            type="button"
            aria-label="Toggle theme">
            <span class="theme-dot" aria-hidden="true"></span>
            <span id="themeLabel">Theme: light</span>
          </button>
        </div>
      </div>
    </div>

    <section id="fields-panel" class="log-panel hidden" aria-label="Alle velden">
      <div class="log-header">
        <span>Alle velden</span>
      </div>
      <div id="field-all" class="log-body">–</div>
    </section>

    <section id="log-panel" class="log-panel hidden" aria-label="Log">
      <div class="log-header">
        <span>Log</span>
        <span class="log-controls">
          <button id="clear-log-btn" type="button">Clear</button>
        </span>
      </div>
      <div id="log" class="log-body">Log start…</div>
    </section>
  </main>

  <script>
    (function () {
      const THEME_KEY = "bs_theme";
      const html = document.documentElement;

      function applyTheme(theme) {
        html.setAttribute("data-theme", theme);
        const label = document.getElementById("themeLabel");
        if (label) label.textContent = "Theme: " + theme;
      }

      function getInitialTheme() {
        const saved = localStorage.getItem(THEME_KEY);
        if (saved === "light" || saved === "dark") return saved;
        return window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches
          ? "dark"
          : "light";
      }

      document.addEventListener("DOMContentLoaded", () => {
        applyTheme(getInitialTheme());

        const tbtn = document.getElementById("themeToggle");
        if (tbtn) {
          tbtn.addEventListener("click", () => {
            const current =
              html.getAttribute("data-theme") === "dark" ? "dark" : "light";
            const next = current === "dark" ? "light" : "dark";
            localStorage.setItem(THEME_KEY, next);
            applyTheme(next);
            if (typeof window.logMessage === "function") {
              window.logMessage("[theme] " + next);
            }
          });
        }
      });

      function appendToPanel(line) {
        const el = document.getElementById("log");
        if (!el) return;
        if (el.textContent === "Log start…") el.textContent = "";
        el.textContent += line + "\n";
        el.scrollTop = el.scrollHeight;
      }

      if (typeof window.logMessage !== "function") {
        window.logMessage = function (msg) {
          appendToPanel(String(msg));
          console.log(msg);
        };
      }

      document.addEventListener("DOMContentLoaded", () => {
        const btn = document.getElementById("clear-log-btn");
        if (btn) {
          btn.addEventListener("click", () => {
            const el = document.getElementById("log");
            if (el) el.textContent = "";
          });
        }

        const toggle = document.getElementById("toggle-log-btn");
        const panel = document.getElementById("log-panel");
        if (toggle && panel) {
          toggle.addEventListener("click", () => {
            panel.classList.toggle("hidden");
          });
        }
      });

      window.logMessage("[words.html] Inline logger ready.");
    })();
  </script>

  <script src="../js/logging.js"></script>
  <script src="../js/braillebridge.js"></script>
  <script src="../components/braille-monitor/braillemonitor.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
  <script src="../js/sounds.js"></script>

  <script src="../activities/tts.js"></script>
  <script src="../activities/letters.js"></script>
  <script src="../activities/words.js"></script>
  <script src="../activities/story.js"></script>
  <script src="../activities/sounds.js"></script>

  <!-- If you use an external runner, it must load before words.js -->
  <script src="../js/activity-runner.js"></script>

  <!-- Main page logic -->
  <script src="../js/words.js"></script>
</body>
</html>