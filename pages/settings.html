<!-- /settings.html -->
<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Settings</title>

  <style>
    :root{
      --bg:#0b0c10;
      --panel:#12141b;
      --text:#e8eaf0;
      --muted:#aab0c0;
      --border:#2a2f3a;
      --btn:#1b2030;
      --btn2:#232a3d;
      --focus:#8aa4ff;
      --radius:12px;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f6f7fb;
        --panel:#ffffff;
        --text:#111827;
        --muted:#6b7280;
        --border:#e5e7eb;
        --btn:#eef2ff;
        --btn2:#e5e7ff;
        --focus:#3056ff;
      }
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.4;
    }
    header{
      position:sticky;
      top:0;
      background:linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0));
      backdrop-filter: blur(8px);
      border-bottom:1px solid var(--border);
    }
    .wrap{
      max-width: 880px;
      margin: 0 auto;
      padding: 16px;
    }
    .bar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 10px 0;
    }
    h1{ font-size:18px; margin:0; }

    main .card{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:16px;
      margin-top:16px;
    }
    .row{
      display:grid;
      grid-template-columns: 220px 1fr;
      gap:14px;
      align-items:start;
      padding:12px 0;
      border-top:1px solid var(--border);
    }
    .row:first-child{ border-top:none; padding-top:0; }
    .label{ font-weight:700; }
    .hint{ color:var(--muted); font-size:13px; margin-top:6px; }

    select{
      width:100%;
      border-radius:10px;
      border:1px solid var(--border);
      background:transparent;
      color:var(--text);
      padding:10px 12px;
      font-size:15px;
    }
    select:focus-visible, input:focus-visible{
      outline: 3px solid color-mix(in srgb, var(--focus) 55%, transparent);
      outline-offset: 2px;
    }
    .toggle{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .toast{
      margin-top:12px;
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius:10px;
      background: color-mix(in srgb, var(--panel) 60%, transparent);
      display:none;
    }
    .toast.show{ display:block; }
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="bar">
      <h1>Settings</h1>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <div class="card">

      <!-- Language -->
      <div class="row">
        <div>
          <div class="label">Language</div>
          <div class="hint">Used by runner and BrailleMonitor.</div>
        </div>
        <div>
          <select id="langSelect">
            <option value="nl">Nederlands (nl)</option>
            <option value="en">English (en)</option>
          </select>
        </div>
      </div>

      <!-- SSOC Simulator -->
      <div class="row">
        <div>
          <div class="label">SSOC Simulator</div>
          <div class="hint">Enable BrailleMonitor simulator when BrailleBridge is unavailable.</div>
        </div>
        <div class="toggle">
          <input type="checkbox" id="simToggle" />
          <label for="simToggle">Use simulator</label>
        </div>
      </div>

      <!-- Method -->
      <div class="row">
        <div>
          <div class="label">Method</div>
          <div class="hint">Select the active teaching method.</div>
        </div>
        <div>
          <select id="methodSelect">
            <option value="mpop.json">MPOP</option>
            <option value="marechal.json">Mar√©chal</option>
          </select>
        </div>
      </div>

      <div id="toast" class="toast" role="status" aria-live="polite"></div>
    </div>
  </div>
</main>

<script>
(function () {
  "use strict";

  const STORAGE_KEY = "localstorage.json";

  const defaults = {
    lang: "nl",
    ssocSimulator: true,
    method: "mpop.json"
  };

  function load() {
    try {
      return { ...defaults, ...(JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}) };
    } catch {
      return { ...defaults };
    }
  }

  function save(state) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    toast("Saved");
  }

  function toast(msg) {
    elToast.textContent = msg;
    elToast.classList.add("show");
    setTimeout(() => elToast.classList.remove("show"), 1200);
  }

  const elLang   = document.getElementById("langSelect");
  const elSim    = document.getElementById("simToggle");
  const elMethod = document.getElementById("methodSelect");
  const elToast  = document.getElementById("toast");

  let state = load();

  function syncUI() {
    elLang.value   = state.lang;
    elSim.checked  = !!state.ssocSimulator;
    elMethod.value = state.method;
    document.documentElement.setAttribute("lang", state.lang);
  }

  function update(partial) {
    state = { ...state, ...partial };
    save(state);
  }

  elLang.addEventListener("change", () =>
    update({ lang: elLang.value })
  );

  elSim.addEventListener("change", () =>
    update({ ssocSimulator: elSim.checked })
  );

  elMethod.addEventListener("change", () =>
    update({ method: elMethod.value })
  );

  window.addEventListener("pageshow", () => {
    state = load();
    syncUI();
  });

  syncUI();
})();
</script>
</body>
</html>