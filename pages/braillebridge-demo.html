<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <title>BrailleUI Demo ‚Äì BrailleServer</title>

    <link rel="stylesheet" href="../css/style.css" />

    <style>
      /* Kleine layout-tweaks specifiek voor demo-pagina */

      body {
        margin: 0;
        padding: 20px;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Arial, sans-serif;
        background: #f3f4f6;
      }

      .demo-container {
        max-width: 900px;
        margin: 0 auto;
        background: #ffffff;
        border-radius: 16px;
        padding: 20px 24px 28px 24px;
        box-shadow: 0 10px 30px rgba(15, 23, 42, 0.12);
      }

      h1 {
        margin-top: 0;
        margin-bottom: 0.25em;
        font-size: 1.6rem;
      }

      h2 {
        margin-top: 1.7em;
        margin-bottom: 0.4em;
        font-size: 1.2rem;
      }

      .demo-subtitle {
        margin: 0 0 1.2em 0;
        color: #6b7280;
        font-size: 0.95rem;
      }

      .status-pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 0.8rem;
        font-weight: 500;
        background: #fee2e2;
        color: #b91c1c;
      }

      .status-pill.connected {
        background: #dcfce7;
        color: #166534;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: currentColor;
      }

      .demo-row {
        margin-top: 6px;
        margin-bottom: 12px;
      }

      .demo-row label {
        display: block;
        font-size: 0.85rem;
        margin-bottom: 4px;
        color: #4b5563;
      }

      .demo-row input[type="text"] {
        width: 100%;
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid #d1d5db;
        font-size: 0.95rem;
      }

      .demo-actions {
        margin-top: 8px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .demo-actions button {
        font-size: 0.85rem;
        padding: 6px 12px;
        border-radius: 999px;
        border: 1px solid #d1d5db;
        background: #f9fafb;
        cursor: pointer;
        transition: background 0.15s ease, box-shadow 0.15s ease,
          transform 0.05s ease;
      }

      .demo-actions button:hover {
        background: #e5e7eb;
        box-shadow: 0 2px 6px rgba(15, 23, 42, 0.15);
      }

      .demo-actions button:active {
        transform: translateY(1px);
        box-shadow: none;
      }

      .demo-actions button.primary {
        background: #111827;
        color: #f9fafb;
        border-color: #111827;
      }

      .demo-actions button.primary:hover {
        background: #030712;
      }

      #cursorInfoBox {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Cascadia Code", "Fira Code", "Liberation Mono", "Courier New",
          monospace;
        font-size: 0.85rem;
        padding: 8px 10px;
        background: #f9fafb;
        border-radius: 10px;
        border: 1px solid #e5e7eb;
        min-height: 40px;
      }

      #logBox {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Cascadia Code", "Fira Code", "Liberation Mono", "Courier New",
          monospace;
        font-size: 0.8rem;
        padding: 8px 10px;
        background: #0b1120;
        color: #e5e7eb;
        border-radius: 10px;
        border: 1px solid #1f2937;
        min-height: 120px;
        max-height: 260px;
        overflow-y: auto;
        white-space: pre-wrap;
      }
    </style>
  </head>

  <body>
    <div class="demo-container">
      <h1>BrailleUI Demo</h1>
      <p class="demo-subtitle">
        Test de verbinding met de lokale BrailleBridge, bekijk de
        braille-monitor en simuleer duimtoetsen.
      </p>

      <!-- Verbinding -->
      <h2>Verbinding</h2>
      <div class="demo-row">
        <span id="connectionStatus" class="status-pill">
          <span class="status-dot"></span>
          disconnected
        </span>
        <button id="btnConnect" style="margin-left: 10px">
          Verbind met BrailleBridge
        </button>
      </div>

      <!-- Braille-monitor -->
      <h2>Braille-monitor (1:1 met leesregel)</h2>
      <div class="braille-monitor-label">
        Toon exact de 40 braillecellen (inclusief spaties).
      </div>
      <div id="currentLineBox" class="braille-monitor">(leeg)</div>

      <!-- Thumbkey-buttons -->
      <div class="thumbkey-buttons" aria-label="Simuleer duimtoetsen">
        <button type="button" data-thumb="LeftThumb">LeftThumb</button>
        <button type="button" data-thumb="MiddleLeftThumb">
          MiddleLeftThumb
        </button>
        <button type="button" data-thumb="MiddleRightThumb">
          MiddleRightThumb
        </button>
        <button type="button" data-thumb="RightThumb">RightThumb</button>
      </div>

      <!-- Regel sturen -->
      <h2>Regel sturen</h2>
      <div class="demo-row">
        <div class="demo-actions">
          <button id="btnHallo" class="primary" type="button">
            Stuur ‚ÄúHallo braille!‚Äù
          </button>
        </div>
      </div>

      <div class="demo-row">
        <label for="customTextInput">Eigen tekst:</label>
        <input
          type="text"
          id="customTextInput"
          placeholder="Typ een tekst om naar de brailleleesregel te sturen‚Ä¶"
        />
        <div class="demo-actions">
          <button id="btnSendCustom" type="button">Stuur eigen tekst</button>
          <button id="btnRepeat" type="button">Herhaal huidige regel</button>
          <button id="btnClear" type="button">Maak leeg</button>
        </div>
      </div>

      <!-- Cursorinformatie -->
      <h2>Laatste cursorinformatie</h2>
      <div id="cursorInfoBox">Nog niets‚Ä¶</div>

      <!-- Logging -->
      <h2>Logging</h2>
      <div id="logBox"></div>
    </div>

    <!-- Scripts -->
    <script src="../js/braillebridge.js"></script>
    <script src="../js/brailleui.js"></script>

    <script>
      (function () {
        "use strict";

        const bridge = window.BrailleBridge;
        const ui = window.BrailleUI;

        // -----------------------------------------------------
        // Helpers
        // -----------------------------------------------------
        const connectionStatusEl = document.getElementById("connectionStatus");
        const btnConnect = document.getElementById("btnConnect");
        const logBox = document.getElementById("logBox");
        const cursorInfoBox = document.getElementById("cursorInfoBox");
        const customTextInput = document.getElementById("customTextInput");

        function setStatus(connected) {
          if (!connectionStatusEl) return;
          connectionStatusEl.classList.toggle("connected", !!connected);
          connectionStatusEl.textContent = connected
            ? "connected"
            : "disconnected";

          const dot = document.createElement("span");
          dot.className = "status-dot";
          connectionStatusEl.prepend(dot);
        }

        function logMessage(msg) {
          if (!logBox) return;
          const now = new Date();
          const ts = now.toISOString().split("T")[1].substring(0, 8);
          logBox.textContent += "[" + ts + "] " + msg + "\n";
          logBox.scrollTop = logBox.scrollHeight;
        }

        // Simuleer een duimtoets door direct het 'thumbkey' event van
        // BrailleBridge te emitten. Dit is puur aan de JS-kant.
        function simulateThumbKey(name) {
          if (!bridge || typeof bridge.emit !== "function") {
            logMessage("‚ö†Ô∏è Kan thumbkey niet simuleren: geen bridge.emit()");
            return;
          }

          const evt = {
            raw: { Kind: 2, IsPress: true, Name: name },
            kindRaw: "thumbkey",
            kind: "thumbkey",
            press: true,
            name,
            nameLower: String(name).toLowerCase(),
          };

          logMessage("üñ±Ô∏è Simulated thumbkey: " + name);
          bridge.emit("thumbkey", evt);
        }

        // -----------------------------------------------------
        // BrailleBridge configureren
        // -----------------------------------------------------
        bridge.setConfig({
          debug: false,
          baseUrl: "http://localhost:5000",
          wsUrl: "ws://localhost:5000/ws",
          displayCells: 40,
        });

        // Logging van bridge
        bridge.on("connected", () => {
          setStatus(true);
          logMessage("‚úÖ WebSocket connected");
        });

        bridge.on("disconnected", (evt) => {
          setStatus(false);
          logMessage(
            "‚ùå WebSocket disconnected (code=" +
              evt.code +
              ", reason=" +
              evt.reason +
              ")"
          );
        });

        bridge.on("error", (err) => {
          logMessage("üí• Bridge error: " + JSON.stringify(err));
        });

        bridge.on("http", (evt) => {
          logMessage(
            "üåê HTTP " + evt.path + " ‚Üí " + evt.status + " (ok=" + evt.ok + ")"
          );
        });

        bridge.on("thumbkey", (evt) => {
          logMessage("üîµ thumbkey: " + evt.name);
        });

        bridge.on("cursor", (evt) => {
          // Dit pakt BrailleUI ook al op via autoAttachCursor,
          // maar we loggen hier nog extra informatie.
          logMessage("üéØ cursor index: " + evt.index);
        });

        // -----------------------------------------------------
        // BrailleUI koppelen
        // -----------------------------------------------------
        ui.setOptions({
          displayCells: 40,
          debug: false,
        });

        ui.attachMonitor("currentLineBox");

        // Cursor-info vanuit BrailleUI
        ui.on("cursorChar", (evt) => {
          const text =
            "Index: " +
            evt.index +
            "\n" +
            "Char:  " +
            (evt.char || " ") +
            "\n" +
            "Lijn:  " +
            evt.lineIndex;
          cursorInfoBox.textContent = text;
        });

        ui.on("cursorWord", (evt) => {
          logMessage(
            "üü¢ cursorWord: '" +
              evt.word +
              "' (start=" +
              evt.start +
              ", end=" +
              evt.end +
              ")"
          );
        });

        ui.on("lineChanged", (evt) => {
          logMessage("üîÅ lineChanged: '" + evt.line + "'");
        });

        // -----------------------------------------------------
        // UI events
        // -----------------------------------------------------
        btnConnect.addEventListener("click", () => {
          logMessage("üîå Connecting WebSocket...");
          bridge.connect();
        });

        document
          .getElementById("btnHallo")
          .addEventListener("click", async () => {
            try {
              await ui.setText("Hallo braille!");
              logMessage("‚û°Ô∏è Stuurde: 'Hallo braille!'");
            } catch (err) {
              logMessage("üí• Fout bij setText: " + err);
            }
          });

        document
          .getElementById("btnSendCustom")
          .addEventListener("click", async () => {
            const value = customTextInput.value || "";
            try {
              await ui.setText(value);
              logMessage("‚û°Ô∏è Stuurde eigen tekst: '" + value + "'");
            } catch (err) {
              logMessage("üí• Fout bij setText: " + err);
            }
          });

        document
          .getElementById("btnRepeat")
          .addEventListener("click", async () => {
            try {
              await ui.repeatLine();
              logMessage("üîÅ repeatLine()");
            } catch (err) {
              logMessage("üí• Fout bij repeatLine: " + err);
            }
          });

        document
          .getElementById("btnClear")
          .addEventListener("click", async () => {
            try {
              await ui.clear();
              logMessage("üßπ clear()");
            } catch (err) {
              logMessage("üí• Fout bij clear: " + err);
            }
          });

        // Thumbkey-buttons
        document
          .querySelectorAll(".thumbkey-buttons button")
          .forEach((btn) => {
            btn.addEventListener("click", () => {
              const name = btn.getAttribute("data-thumb");
              simulateThumbKey(name);
            });
          });

        // Option: automatisch verbinden bij laden
        // bridge.connect();
      })();
    </script>
  </body>
</html>
