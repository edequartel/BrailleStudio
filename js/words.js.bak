// words.js
// Simple viewer that steps through the records one at a time.

// /js/words.js
(function () {
  "use strict";

  // ------------------------------------------------------------
  // Logging helper (uses logging.js if available)
  // ------------------------------------------------------------
  function log(msg, data) {
    if (typeof logMessage === "function") {
      logMessage(data ? msg + " " + JSON.stringify(data) : msg);
    } else {
      console.log(msg, data || "");
    }
  }

  log("[words] words.js loaded");

  // ------------------------------------------------------------
  // State
  // ------------------------------------------------------------
  let records = [];
  let currentIndex = 0;

  // ------------------------------------------------------------
  // DOM helper
  // ------------------------------------------------------------
  function $(id) {
    const el = document.getElementById(id);
    if (!el) log(`[words] Missing element #${id}`);
    return el;
  }

  // ------------------------------------------------------------
  // Render
  // ------------------------------------------------------------
  function render() {
    if (!records.length) {
      log("[words] No records to render");
      return;
    }

    const item = records[currentIndex];
    log("[words] Rendering record", item);

    $("item-id").textContent = "ID: " + item.id;
    $("item-index").textContent = `${currentIndex + 1} / ${records.length}`;
    $("field-word").textContent = item.word;

    $("field-letters").textContent = item.letters.join(" ");
    $("field-words").textContent = item.words.join(", ");
    $("field-story").textContent = item.story.join(", ");
    $("field-sounds").textContent = item.sounds.join(", ");
    $("field-icon").textContent = item.icon;

    $("short-flag").style.display = item.short ? "inline-flex" : "none";
  }

  // ------------------------------------------------------------
  // Navigation
  // ------------------------------------------------------------
  function next() {
    currentIndex = (currentIndex + 1) % records.length;
    log("[words] Next pressed", { currentIndex });
    render();
  }

  function prev() {
    currentIndex = (currentIndex - 1 + records.length) % records.length;
    log("[words] Prev pressed", { currentIndex });
    render();
  }

  // ------------------------------------------------------------
  // Load JSON
  // ------------------------------------------------------------
  async function loadData() {
    const url = "../config/words.json";
    log("[words] Loading JSON", url);

    try {
      const response = await fetch(url);
      log("[words] Fetch response", response.status);

      if (!response.ok) {
        throw new Error("HTTP " + response.status);
      }

      records = await response.json();
      log("[words] JSON loaded", { count: records.length });

      render();
    } catch (err) {
      log("[words] ERROR loading JSON", err.message);
    }
  }

  // ------------------------------------------------------------
  // Init
  // ------------------------------------------------------------
  document.addEventListener("DOMContentLoaded", () => {
    log("[words] DOMContentLoaded");

    $("next-btn").addEventListener("click", next);
    $("prev-btn").addEventListener("click", prev);

    loadData();
  });
})();
