<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Braille Tables</title>
  <style>
    :root {
      --bg: #0e1117;
      --panel: #121826;
      --panel-2: #151c2b;
      --text: #e7edf5;
      --muted: #9aa7b6;
      --accent: #5dd6c7;
      --accent-2: #6fa4ff;
      --border: rgba(255,255,255,.10);
      --shadow: 0 18px 40px rgba(0,0,0,.30);
      --radius: 14px;
      --mono: "IBM Plex Mono", "SFMono-Regular", Menlo, Consolas, monospace;
      --sans: "Space Grotesk", "Avenir Next", "Segoe UI", sans-serif;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(900px 700px at 8% 10%, rgba(111,164,255,.18), transparent 60%),
        radial-gradient(800px 600px at 95% 15%, rgba(93,214,199,.15), transparent 55%),
        linear-gradient(180deg, #0b0f16, #0e1117 35%, #0b1018 100%);
    }

    header {
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(10px);
      background: color-mix(in oklab, var(--bg) 85%, transparent);
      border-bottom: 1px solid var(--border);
    }

    .wrap {
      max-width: 1200px;
      margin: 0 auto;
      padding: 18px;
    }

    .topbar {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 14px;
      align-items: center;
    }

    .title h1 {
      margin: 0;
      font-size: 20px;
      letter-spacing: .3px;
    }
    .title .sub {
      margin-top: 4px;
      color: var(--muted);
      font-family: var(--mono);
      font-size: 12px;
    }

    .controls {
      display: grid;
      grid-template-columns: 180px 1fr auto;
      gap: 10px;
      align-items: center;
    }
    @media (max-width: 980px) {
      .topbar { grid-template-columns: 1fr; }
      .controls { grid-template-columns: 1fr; }
    }

    input[type="text"] {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 12px;
      font-size: 13px;
      background: color-mix(in oklab, var(--panel) 85%, black 15%);
      color: var(--text);
      font-family: var(--mono);
    }

    .btn {
      appearance: none;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 14px;
      background: linear-gradient(180deg, color-mix(in oklab, var(--panel) 90%, white 10%), var(--panel));
      color: var(--text);
      cursor: pointer;
      font-size: 13px;
      box-shadow: var(--shadow);
      transition: transform .08s ease, border-color .15s ease;
    }
    .btn:active { transform: translateY(1px); }
    .btn.primary { border-color: color-mix(in oklab, var(--accent) 65%, var(--border)); }

    main .wrap { padding-top: 12px; }

    .stats {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
      margin: 16px 0 10px;
    }
    @media (max-width: 760px) {
      .stats { grid-template-columns: 1fr; }
    }

    .stat {
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      padding: 12px 14px;
      box-shadow: var(--shadow);
    }
    .stat .label {
      font-size: 12px;
      color: var(--muted);
    }
    .stat .value {
      margin-top: 6px;
      font-family: var(--mono);
      font-size: 13px;
    }

    .list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 12px;
      margin-top: 16px;
    }

    .card {
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 12px;
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      box-shadow: var(--shadow);
      display: grid;
      gap: 8px;
    }

    .name {
      font-size: 14px;
      font-weight: 600;
      letter-spacing: .2px;
    }

    .desc {
      font-size: 12px;
      color: var(--muted);
      line-height: 1.4;
      min-height: 36px;
    }

    .chips {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .chip {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-family: var(--mono);
      background: color-mix(in oklab, var(--panel-2) 80%, transparent);
    }

    .status {
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
    }

    .status.ok { color: var(--accent); }
    .status.err { color: #ff7b7b; }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="topbar">
        <div class="title">
          <h1>Braille tables</h1>
          <div class="sub">Fetches from <span id="baseLabel"></span>/tables</div>
        </div>
        <div class="controls">
          <input id="baseUrl" type="text" value="http://localhost:5000" aria-label="Base URL" />
          <input id="search" type="text" placeholder="Filter by language, filename, description..." aria-label="Search tables" />
          <button class="btn primary" id="refreshBtn">Refresh</button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <div class="stats">
        <div class="stat">
          <div class="label">Total tables</div>
          <div class="value" id="totalCount">—</div>
        </div>
        <div class="stat">
          <div class="label">Matching filter</div>
          <div class="value" id="filteredCount">—</div>
        </div>
        <div class="stat">
          <div class="label">Status</div>
          <div class="value status" id="statusText">idle</div>
        </div>
      </div>

      <div class="list" id="tableList"></div>
    </div>
  </main>

  <script>
    (function () {
      const el = (id) => document.getElementById(id);
      const baseUrl = el("baseUrl");
      const baseLabel = el("baseLabel");
      const search = el("search");
      const refreshBtn = el("refreshBtn");
      const totalCount = el("totalCount");
      const filteredCount = el("filteredCount");
      const statusText = el("statusText");
      const tableList = el("tableList");

      let tables = [];

      function setStatus(text, state) {
        statusText.textContent = text;
        statusText.classList.remove("ok", "err");
        if (state) statusText.classList.add(state);
      }

      function refreshBaseLabel() {
        const base = baseUrl.value.trim().replace(/\/$/, "");
        baseLabel.textContent = base || "(empty)";
      }

      function chip(label) {
        const span = document.createElement("span");
        span.className = "chip";
        span.textContent = label;
        return span;
      }

      function addIfValue(chips, label, value) {
        if (value === null || value === undefined || value === "") return;
        chips.appendChild(chip(`${label}: ${value}`));
      }

      function addIfArray(chips, label, arr) {
        if (!Array.isArray(arr) || arr.length === 0) return;
        chips.appendChild(chip(`${label}: ${arr.join(", ")}`));
      }

      function render() {
        const q = search.value.trim().toLowerCase();
        const filtered = tables.filter((t) => {
          if (!q) return true;
          const hay = [
            t.FileName,
            t.DisplayName,
            t.Language,
            t.Region,
            t.Grade,
            t.Description
          ].filter(Boolean).join(" ").toLowerCase();
          return hay.includes(q);
        });

        filteredCount.textContent = String(filtered.length);
        tableList.innerHTML = "";

        filtered.forEach((t) => {
          const card = document.createElement("div");
          card.className = "card";

          const name = document.createElement("div");
          name.className = "name";
          name.textContent = t.DisplayName || t.FileName || "Unnamed table";

          const desc = document.createElement("div");
          desc.className = "desc";
          desc.textContent = t.Description || "No description";

          const chips = document.createElement("div");
          chips.className = "chips";
          addIfValue(chips, "Lang", t.Language);
          addIfValue(chips, "Region", t.Region);
          addIfValue(chips, "Grade", t.Grade);
          addIfArray(chips, "Type", t.Metadata && t.Metadata.type);
          addIfArray(chips, "Contract", t.Metadata && t.Metadata.contraction);
          addIfArray(chips, "System", t.Metadata && t.Metadata.system);
          addIfArray(chips, "Dots", t.Metadata && t.Metadata.dots);
          addIfArray(chips, "Dir", t.Metadata && t.Metadata.direction);
          addIfArray(chips, "Variant", t.Metadata && t.Metadata.variant);

          card.appendChild(name);
          card.appendChild(desc);
          card.appendChild(chips);
          tableList.appendChild(card);
        });
      }

      async function loadTables() {
        const base = baseUrl.value.trim().replace(/\/$/, "");
        if (!base) {
          setStatus("missing base url", "err");
          return;
        }
        setStatus("loading...", "");
        refreshBaseLabel();
        try {
          const resp = await fetch(base + "/tables");
          const data = await resp.json();
          if (!resp.ok || !data || data.ok !== true) {
            throw new Error("bad response");
          }
          tables = Array.isArray(data.tables) ? data.tables : [];
          totalCount.textContent = String(data.count ?? tables.length);
          setStatus("ok", "ok");
          render();
        } catch (err) {
          tables = [];
          totalCount.textContent = "—";
          filteredCount.textContent = "—";
          tableList.innerHTML = "";
          setStatus("error fetching tables", "err");
        }
      }

      baseUrl.addEventListener("input", refreshBaseLabel);
      search.addEventListener("input", render);
      refreshBtn.addEventListener("click", loadTables);

      refreshBaseLabel();
      loadTables();
    })();
  </script>
</body>
</html>
